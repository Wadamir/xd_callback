<?xml version="1.0" encoding="utf-8"?>
<modification>
	<code>xdz200</code>
    <name>callback for Opencart 2.x, 3.x</name>
    <version>1.1.1</version>
    <author>Domus159@gmail.com</author>
    <link>https://xdomus.ru/opencart/obratnyj-zvonok-dlya-opencart-2-besplatno/</link>
    <file path="catalog/controller/common/header.php">
        <operation>
            <search>
				<![CDATA[
					$data['telephone'] = $this->config->get('config_telephone');
				]]>
			</search>
            <add position="after">
				<![CDATA[
					$data['callback_status'] = $this->config->get('callback_status');
					$data['callback_validation_type'] = $this->config->get('callback_validation_type');
					$current_language_id = $this->config->get('config_language_id');
					$data['callback_button_name'] = $this->config->get('callback_button_name_'.$current_language_id);
					if ($data['callback_button_name'] == '') {
						$data['callback_button_name'] = $this->language->get('callback_button_name');
					}
				]]>
			</add>
        </operation>
    </file>
    <file path="catalog/view/theme/*/template/common/header.tpl">
        <operation>
            <search>
				<![CDATA[
					</head>
				]]>
			</search>
            <add position="before"><![CDATA[
				<?php if ($callback_status) { ?>
					<script src="catalog/view/javascript/callback.js" type="text/javascript"></script>
					<script src="catalog/view/javascript/sourcebuster.min.js" type="text/javascript"></script>
					<link href="catalog/view/theme/default/stylesheet/callback.css" rel="stylesheet">
					<?php if ($callback_status && $callback_validation_type != 0) { ?>
						<script src="catalog/view/javascript/jquery.mask.min.js" type="text/javascript"></script>
						<script>
							$(document).ready(function(){
								$('#callback_phone').mask('<?php echo $callback_validation_type; ?>');
							});
						</script>
					<?php } ?>
				<?php } ?>
            ]]></add>
        </operation>
        <operation>
            <search>
				<![CDATA[
					<body class="<?php echo $class; ?>">
				]]>
			</search>
            <add position="after"><![CDATA[
				<?php if ($callback_status) { ?>
					<div class="pull-left">
						<a href="javascript:void(0)" onclick="$('#callback_modal').modal('show');" id="callback_phone_button" class="btn btn-link">
							<div class="circlephone" style="transform-origin: center;"></div>
							<div class="circle-fill" style="transform-origin: center;"></div>
							<div class="img-circle" style="transform-origin: center;">
								<div class="img-circleblock" style="transform-origin: center;"><p style="margin:0;"><?php echo $callback_button_name; ?></p></div>
							</div>
						</a>
					</div>
				<?php } ?>
            ]]></add>
        </operation>
    </file>
    <file path="catalog/controller/common/footer.php">
        <operation>
            <search>
				<![CDATA[
					$this->load->language('common/footer');
				]]>
			</search>
            <add position="before"><![CDATA[
				// callback
					$this->load->model('setting/setting');
					$data['callback_status'] = $this->config->get('callback_status');
					$current_language_id = $this->config->get('config_language_id');
					$data['callback_success_field'] = $this->config->get('callback_success_field_'.$current_language_id);

					$data['callback_field1_status'] = $this->config->get('callback_field1_status');
					$data['callback_field1_required'] = $this->config->get('callback_field1_required');
					$data['callback_field2_status'] = $this->config->get('callback_field2_status');
					$data['callback_field2_required'] = $this->config->get('callback_field2_required');
					$data['callback_field3_status'] = $this->config->get('callback_field3_status');
					$data['callback_field3_required'] = $this->config->get('callback_field3_required');
					$data['callback_validation_status'] = $this->config->get('callback_validation_status');
					$data['callback_validation_type'] = $this->config->get('callback_validation_type');

					$this->load->language('module/callback');
					$data['callback_modal_title'] = $this->language->get('callback_modal_title');
					$data['callback_submit_button'] = $this->language->get('callback_submit_button');

					if ($data['callback_success_field'] == '') {
						$data['callback_success_field'] = htmlspecialchars_decode($this->language->get('callback_success_field'));
					} else {
						$data['callback_success_field'] = htmlspecialchars_decode($data['callback_success_field']);
					}

					$data['callback_field1_title'] = $this->language->get('callback_field1_title');
					$data['callback_field2_title'] = $this->language->get('callback_field2_title');
					$data['callback_field3_title'] = $this->language->get('callback_field3_title');
					$data['callback_required_text'] = $this->language->get('callback_required_text');
					$data['callback_error_required'] = $this->language->get('callback_error_required');
					$data['callback_error_sending'] = $this->language->get('callback_error_sending');

					$data['callback_agree_status'] = $this->config->get('callback_agree_status');

					$this->load->model('catalog/information');
					$information_info = $this->model_catalog_information->getInformation($this->config->get('callback_agree_status'));
					if ($information_info) {
						$data['callback_text_agree'] = sprintf($this->language->get('callback_text_agree'), $this->url->link('information/information/agree', 'information_id=' . $this->config->get('callback_agree_status'), 'SSL'), $information_info['title'], $information_info['title']);
					} else {
						$data['callback_text_agree'] = '';
					}
				// callback
            ]]></add>
        </operation>
    </file>
    <file path="catalog/view/theme/*/template/common/footer.tpl">
        <operation>
            <search>
				<![CDATA[
					</body></html>
				]]>
			</search>
            <add position="before"><![CDATA[
				<?php if ($callback_status) { ?>
					<div id="callback_success" class="modal fade">
						<div class="modal-dialog">
							<div class="modal-content">
								<div class="modal-body">
									<div class="text-center"><?php echo $callback_success_field; ?></div>
								</div>
							</div>
						</div>
					</div>
					<div id="callback_modal" class="modal fade">
						<div class="modal-dialog">
							<div class="modal-content">
								<form id="callback-form" action="index.php?route=module/callback/send" role="form">
									<fieldset>
										<div class="modal-header">
											<button class="close" type="button" data-dismiss="modal">Ã—</button>
											<h2 class="modal-title"><?php echo $callback_modal_title; ?></h2>
										</div>
										<div class="modal-body">
											<div class="col-sm-12">
												<div id="source" style="display:none">
													<input id="sb_first_typ" class="hidden" type="text" name="sb_first_typ" value="">
													<input id="sb_first_src" class="hidden" type="text" name="sb_first_src" value="">
													<input id="sb_first_mdm" class="hidden" type="text" name="sb_first_mdm" value="">
													<input id="sb_first_cmp" class="hidden" type="text" name="sb_first_cmp" value="">
													<input id="sb_first_cnt" class="hidden" type="text" name="sb_first_cnt" value="">
													<input id="sb_first_trm" class="hidden" type="text" name="sb_first_trm" value="">
													
													<input id="sb_current_typ" class="hidden" type="text" name="sb_current_typ" value="">
													<input id="sb_current_src" class="hidden" type="text" name="sb_current_src" value="">
													<input id="sb_current_mdm" class="hidden" type="text" name="sb_current_mdm" value="">
													<input id="sb_current_cmp" class="hidden" type="text" name="sb_current_cmp" value="">
													<input id="sb_current_cnt" class="hidden" type="text" name="sb_current_cnt" value="">
													<input id="sb_current_trm" class="hidden" type="text" name="sb_current_trm" value="">

													<input id="sb_first_add_fd" class="hidden" type="text" name="sb_first_add_fd" value="">
													<input id="sb_first_add_ep" class="hidden" type="text" name="sb_first_add_ep" value="">
													<input id="sb_first_add_rf" class="hidden" type="text" name="sb_first_add_rf" value="">

													<input id="sb_current_add_fd" class="hidden" type="text" name="sb_current_add_fd" value="">
													<input id="sb_current_add_ep" class="hidden" type="text" name="sb_current_add_ep" value="">
													<input id="sb_current_add_rf" class="hidden" type="text" name="sb_current_add_rf" value="">

													<input id="sb_session_pgs" class="hidden" type="text" name="sb_session_pgs" value="">
													<input id="sb_session_cpg" class="hidden" type="text" name="sb_session_cpg" value="">

													<input id="sb_udata_vst" class="hidden" type="text" name="sb_udata_vst" value="">
													<input id="sb_udata_uip" class="hidden" type="text" name="sb_udata_uip" value="">
													<input id="sb_udata_uag" class="hidden" type="text" name="sb_udata_uag" value="">
													<input id="sb_promo_code" class="hidden" type="text" name="sb_promo_code" value="">
												</div>
												<?php if ($callback_field1_status) { ?>
													<div class="input-group<?php if ($callback_field1_required) { echo ' has-warning';} ?>">
														<span class="input-group-addon"><i class="fa fa-fw fa-user" aria-hidden="true"></i></span>
														<input id="callback_name" class="form-control<?php if ($callback_field1_required) { echo ' required';} ?>" type="text" name="callback_name" placeholder="<?php echo $callback_field1_title; ?>">
													</div>
													<input id="callback_name_title" class="hidden" type="text" name="callback_name_title" value="<?php echo $callback_field1_title; ?>">
													<br />
												<?php } ?>
												<?php if ($callback_field2_status) { ?>
													<div class="input-group<?php if ($callback_field2_required) { echo ' has-warning';} ?>">
														<span class="input-group-addon"><i class="fa fa-fw fa-phone-square" aria-hidden="true"></i></span>
														<input id="callback_phone" class="form-control<?php if ($callback_field2_required) { echo ' required';} ?>" type="tel" name="callback_phone" placeholder="<?php echo $callback_field2_title; ?>">
													</div>
													<input id="callback_phone_title" class="hidden" type="text" name="callback_phone_title" value="<?php echo $callback_field2_title; ?>">
													<br />
												<?php } ?>
												<?php if ($callback_field3_status) { ?>
													<div class="form-group<?php if ($callback_field3_required) { echo ' has-warning';} ?>">
														<textarea id="callback_message" class="form-control<?php if ($callback_field3_required) { echo ' required';} ?>" name="callback_message" rows="3" placeholder="<?php echo $callback_field3_title; ?>"></textarea>
													</div>
													<input id="callback_message_title" class="hidden" type="text" name="callback_message_title" value="<?php echo $callback_field3_title; ?>">
												<?php } ?>
											</div>
											<div class="clearfix"></div>
											<?php if ($callback_agree_status) { ?>
												<div class="col-sm-12">
													<p><?php echo $callback_text_agree; ?></p>
												</div>
												<div class="clearfix"></div>
											<?php } ?>
										</div>
										<div class="modal-footer">
											<div class="col-sm-2 hidden-xs">
											</div>
											<div class="col-sm-8 col-xs-12">
												<button type="submit" class="btn btn-lg btn-block btn-default"><?php echo $callback_submit_button; ?></button>
											</div>
											<div class="col-sm-2 hidden-xs">
											</div>
										</div>
									</fieldset>
								</form>
							</div>
						</div>
					</div>
					<script>
						sbjs.init({
							callback: placeData
						});

						function placeData(sb) {
							document.getElementById('sb_first_typ').value       = sb.first.typ;
							document.getElementById('sb_first_src').value       = sb.first.src;
							document.getElementById('sb_first_mdm').value       = sb.first.mdm;
							document.getElementById('sb_first_cmp').value       = sb.first.cmp;
							document.getElementById('sb_first_cnt').value       = sb.first.cnt;
							document.getElementById('sb_first_trm').value       = sb.first.trm;

							document.getElementById('sb_current_typ').value     = sb.current.typ;
							document.getElementById('sb_current_src').value     = sb.current.src;
							document.getElementById('sb_current_mdm').value     = sb.current.mdm;
							document.getElementById('sb_current_cmp').value     = sb.current.cmp;
							document.getElementById('sb_current_cnt').value     = sb.current.cnt;
							document.getElementById('sb_current_trm').value     = sb.current.trm;

							document.getElementById('sb_first_add_fd').value    = sb.first_add.fd;
							document.getElementById('sb_first_add_ep').value    = sb.first_add.ep;
							document.getElementById('sb_first_add_rf').value    = sb.first_add.rf;

							document.getElementById('sb_current_add_fd').value  = sb.current_add.fd;
							document.getElementById('sb_current_add_ep').value  = sb.current_add.ep;
							document.getElementById('sb_current_add_rf').value  = sb.current_add.rf;

							document.getElementById('sb_session_pgs').value     = sb.session.pgs;
							document.getElementById('sb_session_cpg').value     = sb.session.cpg;

							document.getElementById('sb_udata_vst').value       = sb.udata.vst;
							document.getElementById('sb_udata_uip').value       = sb.udata.uip;
							document.getElementById('sb_udata_uag').value       = sb.udata.uag;

							document.getElementById('sb_promo_code').value      = sb.promo.code;
						}
					</script>
				<?php } ?>
            ]]></add>
		</operation>
    </file>
</modification>